{
  "hash": "38b4f396164577f4829a470a4f511069",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"1. Ingeniería de Características\"\nexecute:\n  echo: true\n  warning: false\neditor_options: \n  chunk_output_type: console\n---\n\nEn esta etapa inicial, cargamos los datos, los limpiamos y, lo más importante, aplicamos ingeniería de características para transformar las variables telemáticas granulares en predictores más significativos y robustos.\n\n### Carga y Limpieza de Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar todas las librerías necesarias para el proyecto\ninstall.packages(\"pacman\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe following package(s) will be installed:\n- pacman [0.5.1]\nThese packages will be installed into \"C:/Users/Angel/Downloads/QuartoAngel/TarificacionTelematica/renv/library/windows/R-4.5/x86_64-w64-mingw32\".\n\n# Installing packages --------------------------------------------------------\n- Installing pacman ...                         OK [linked from cache]\nSuccessfully installed 1 package in 8.1 milliseconds.\n```\n\n\n:::\n\n```{.r .cell-code}\ninstall.packages(\"xts\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe following package(s) will be installed:\n- xts [0.14.1]\nThese packages will be installed into \"C:/Users/Angel/Downloads/QuartoAngel/TarificacionTelematica/renv/library/windows/R-4.5/x86_64-w64-mingw32\".\n\n# Installing packages --------------------------------------------------------\n- Installing xts ...                            OK [linked from cache]\nSuccessfully installed 1 package in 8.7 milliseconds.\n```\n\n\n:::\n\n```{.r .cell-code}\ninstall.packages(\"CASdatasets\", repos = \"http://dutangc.free.fr/pub/RRepos/pub/\", type=\"source\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe following package(s) will be installed:\n- CASdatasets [1.2-0]\nThese packages will be installed into \"C:/Users/Angel/Downloads/QuartoAngel/TarificacionTelematica/renv/library/windows/R-4.5/x86_64-w64-mingw32\".\n\n# Installing packages --------------------------------------------------------\n- Installing CASdatasets ...                    OK [linked from cache]\nSuccessfully installed 1 package in 6.8 milliseconds.\n```\n\n\n:::\n\n```{.r .cell-code}\npacman::p_load(dplyr, ggplot2, tidyr, forcats, scales, janitor, corrplot, glmnet, xgboost, mgcv, DT,CASdatasets)\n\n\n# Cargar y limpiar datos\ndata(catelematic13)\nbase_data <- catelematic13 %>%\n  janitor::clean_names() %>% \n  filter(total_miles_driven > 0, car_age >= 0) %>% \n  mutate(across(where(is.character), as.factor))\n```\n:::\n\n\n### Creación de Variables Agregadas\n\nAgrupamos variables que miden conceptos similares para reducir la dimensionalidad y mejorar la interpretabilidad.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nengineered_data <- base_data %>%\n  mutate(\n    # Agrupar eventos de aceleración\n    total_accel_events = rowSums(select(., starts_with(\"accel_\")), na.rm = TRUE),\n    # Agrupar eventos de frenado\n    total_brake_events = rowSums(select(., starts_with(\"brake_\")), na.rm = TRUE),\n    # Agrupar intensidad de giros\n    total_turn_intensity = rowSums(select(., starts_with(\"left_turn_\"), starts_with(\"right_turn_\")), na.rm = TRUE),\n    # Agrupar uso en horas pico\n    pct_drive_rush_total = pct_drive_rush_am + pct_drive_rush_pm,\n  ) %>%\n  # Seleccionar las variables finales para el modelado\n  select(\n    # Variables clave\n    nb_claim, amt_claim, total_miles_driven,\n    # Variables demográficas\n    insured_age, insured_sex, car_age, marital, region, car_use,\n    # Nuevas características ingenieriles\n    total_accel_events, total_brake_events, total_turn_intensity,\n    pct_drive_rush_total, pct_drive_wkday, avgdays_week, annual_pct_driven\n  )\n\n# Guardamos los datos para usarlos en las siguientes páginas\nsaveRDS(engineered_data, \"engineered_data.rds\")\n```\n:::\n\n\n### Análisis de Correlación\n\nLos mapas de calor nos permiten visualizar el éxito de nuestra ingeniería de características.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Correlación de Originales\ntelematic_originals <- base_data %>% select(starts_with(\"accel_\"), starts_with(\"brake_\"), starts_with(\"pct_drive\"))\ncorr_matrix_orig <- cor(telematic_originals, use = \"pairwise.complete.obs\")\ncolors <- colorRampPalette(c(\"#4299E1\", \"white\", \"#F56565\"))(200)\ncorrplot(corr_matrix_orig, method = \"color\", type = \"upper\", order = \"hclust\", col = colors,\n         tl.col = \"black\", tl.srt = 45, tl.cex = 0.8, title = \"Correlación de Variables Originales\", mar=c(0,0,1,0))\n```\n\n::: {.cell-output-display}\n![](about_files/figure-html/Análisis-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Correlación de Nuevas Características\nengineered_features <- engineered_data %>% select(starts_with(\"total_\"), starts_with(\"pct_drive_\"), starts_with(\"avgdays\"), starts_with(\"annual_pct\"))\ncorr_matrix_eng <- cor(engineered_features, use = \"pairwise.complete.obs\")\ncolors_eng <- colorRampPalette(c(\"#48BB78\", \"white\", \"#F6AD55\"))(200)\ncorrplot(corr_matrix_eng, method = \"color\", type = \"upper\", order = \"hclust\", col = colors_eng,\n         tl.col = \"black\", tl.srt = 45, tl.cex = 0.9, addCoef.col = \"black\", number.cex = 0.7, title = \"\\n\\nCorrelación de Características Ingenieriles\", mar=c(0,0,1,0))\n```\n\n::: {.cell-output-display}\n![](about_files/figure-html/Análisis-2.png){width=672}\n:::\n:::\n\n\nNotamos que los bloques de alta correlación en el primer gráfico han desaparecido en el segundo, indicando que nuestras nuevas variables son mucho más independientes entre sí.\n",
    "supporting": [
      "about_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}